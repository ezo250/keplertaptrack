// Prisma schema for Kepler TapTrack
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  email      String   @unique
  password   String
  role       String   // 'super_admin' or 'teacher'
  department String?
  courses    String?  // JSON string array
  avatar     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  devices        Device[]         @relation("CurrentUser")
  deviceHistory  DeviceHistory[]
  notifications  Notification[]
}

model Device {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  deviceId         String    @unique
  status           String    // 'available', 'in_use', 'overdue'
  currentUserId    String?   @db.ObjectId
  currentUserName  String?
  pickedUpAt       DateTime?
  expectedReturnAt DateTime?
  lastReturnedAt   DateTime?
  lastUserId       String?
  lastUserName     String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  currentUser   User?            @relation("CurrentUser", fields: [currentUserId], references: [id])
  deviceHistory DeviceHistory[]
}

model TimetableEntry {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  teacherId   String
  teacherName String
  course      String
  classroom   String?  // Room number or location
  day         String   // 'Monday', 'Tuesday', etc.
  startTime   String
  endTime     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  type      String   // 'reminder', 'overdue', 'success', 'info'
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model DeviceHistory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  deviceId  String   @db.ObjectId
  userId    String   @db.ObjectId
  userName  String
  action    String   // 'pickup' or 'return'
  timestamp DateTime @default(now())

  device Device @relation(fields: [deviceId], references: [id])
  user   User   @relation(fields: [userId], references: [id])
}
